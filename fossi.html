<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<meta name="theme-color" content="#111" />
<title>Fossilium Helper</title>
<style>
  :root { --card:#fff; --ink:#111; --line:#ddd; --box:#f3f4f6; --bg:#fafafa; }
  *{box-sizing:border-box; -webkit-tap-highlight-color: transparent;}
  html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);
            font:15px system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
  .wrap{max-width:820px;margin:0 auto;padding:10px}
  header{display:flex;gap:6px;align-items:center;justify-content:space-between;margin-bottom:8px}
  h1{font-size:18px;margin:0}
  .toolbar{display:flex;gap:6px;flex-wrap:wrap}
  button{border:2px solid #c7cdd4;background:var(--box);border-radius:10px;padding:6px 10px;font-weight:600;font-size:14px}

  /* Opening Phase and Fullscreen button styles */
  #opening{ background:#e8f7ec; border-color:#bfe7c9; color:#0f5b2a; }
  #opening:active{ filter:brightness(.96) }
  #fs{ width:38px; padding:6px 0; font-size:18px; line-height:1; background:#eef2f4; border-color:#cfd6dc; }

  /* Grid: Name ≤ 20%, Regulars narrower than others */
  .grid{display:grid;grid-template-columns:18% 1fr 1fr 0.7fr;gap:6px}
  .hdr{font-weight:700;border-bottom:2px solid var(--ink);padding:4px 2px;font-size:14px;text-align:center}

  .cell{background:var(--card);border:1px solid var(--line);border-radius:8px;padding:6px;overflow:hidden}
  .cell.c-black { background:#e9e9e9; }
  .cell.c-red   { background:#fdecea; }
  .cell.c-blue  { background:#eaf3ff; }
  .cell.c-yellow{ background:#fff7d6; }

  .name .stack{display:flex;flex-direction:column;align-items:stretch;gap:4px;width:100%;}
  .name input{
    font-size:20px; font-weight:700; text-align:center;
    width:100%; max-width:100%; box-sizing:border-box;
    padding:2px 4px; border:1px solid var(--line); border-radius:6px;
  }
  .name input::placeholder{font-size:14px; opacity:0.7;}
  .colorpick{
    width:26px; height:22px; padding:0; border:1px solid var(--line);
    border-radius:6px; appearance:none; background:#fff; text-align:center;
    font-size:12px; line-height:22px; color:#111; align-self:center;
  }
  .colorpick:not(:focus){ color:transparent; }
  .colorpick[data-color="black"]{ background:#e9e9e9; border-color:#d4d4d4; }
  .colorpick[data-color="red"]  { background:#fdecea; border-color:#f5c2b9; }
  .colorpick[data-color="blue"] { background:#eaf3ff; border-color:#cfe2ff; }
  .colorpick[data-color="yellow"]{ background:#fff7d6; border-color:#ffe49a; }

  .val{display:flex;align-items:center;justify-content:center;font-size:22px;font-weight:700}
  .btns{display:flex;gap:3px;justify-content:center;margin-top:4px;flex-wrap:nowrap}
  .btn{
    min-width:34px;padding:8px;border-radius:10px;border:2px solid #c7cdd4;background:var(--box);
    font-weight:700;font-size:16px;line-height:1;text-align:center;user-select:none
  }
  .btn:active{transform:translateY(1px)}
  .sep{grid-column:1/-1;height:1px;background:#ccc;margin:4px 0}

  @media (max-width: 400px){
    .grid{grid-template-columns:17% 1fr 1fr 0.65fr;gap:5px}
    .btns{gap:2px}
    .btn{min-width:30px;padding:7px;font-size:14px}
    .val{font-size:20px}
    button{padding:5px 9px;font-size:13px}
    .name input{font-size:20px}
  }

  /* ===== Inline confirm modal (replaces window.confirm) ===== */
  .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.25);z-index:9999}
  .modal.show{display:flex}
  .modal .card{background:#fff;border:1px solid #e6e6e6;border-radius:12px;padding:14px;max-width:90vw;box-shadow:0 10px 30px rgba(0,0,0,.2)}
  .modal .title{font-weight:700;margin:0 0 8px 0}
  .modal .actions{display:flex;gap:8px;justify-content:flex-end;margin-top:10px}
  .btn-secondary{background:#eef2f4;border-color:#cfd6dc}
  .btn-danger{background:#fdecea;border-color:#f5c2b9;color:#7a1307}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Fossilium Helper</h1>
      <div class="toolbar">
        <button id="opening">Opening Phase</button>
        <button id="reset">Reset</button>
        <button id="fs" title="Toggle fullscreen">⤢</button>
      </div>
    </header>

    <div id="grid" class="grid">
      <div class="hdr">Name</div>
      <div class="hdr">Points</div>
      <div class="hdr">Guests</div>
      <div class="hdr">Regulars</div>
    </div>
  </div>

  <!-- Inline confirm modal -->
  <div id="resetModal" class="modal" aria-modal="true" role="dialog">
    <div class="card">
      <p class="title">Reset all names and values?</p>
      <div class="actions">
        <button id="reset-cancel" class="btn btn-secondary">Cancel</button>
        <button id="reset-ok" class="btn btn-danger">Reset</button>
      </div>
    </div>
  </div>

<script>
const KEY='fossilium_counter_v1';
let state=JSON.parse(localStorage.getItem(KEY)||'null')||[
  {name:'',points:0,guests:0,regulars:0,color:'black'},
  {name:'',points:0,guests:0,regulars:0,color:'black'},
  {name:'',points:0,guests:0,regulars:0,color:'black'},
  {name:'',points:0,guests:0,regulars:0,color:'black'},
];
const LUT=[0,0,1,1,2,2,4,4,5,5,6,6,8,8,8,8,10,10,10,10,12,12,12,12,12,15,15,15,15,15,18];

function save(){localStorage.setItem(KEY,JSON.stringify(state));}
function haptic(){if(navigator.vibrate)navigator.vibrate(8);}
function clampGuests(r){r.guests=Math.min(30,Math.max(+r.regulars||0,+r.guests||0));return r;}
function enforceRow(r){r.points=+r.points||0; r.regulars=+r.regulars||0; r.color=r.color||'black'; return clampGuests(r);}

const grid=document.getElementById('grid');
function rowTemplate(i,r){
  const c = `c-${r.color}`;
  return `
  <div class="cell r name ${c}">
    <div class="stack">
      <input size="3" maxlength="12" value="${escapeHtml(r.name||'')}" placeholder="" oninput="onName(${i},this.value)">
      <select class="colorpick" data-color="${r.color}" onchange="onColor(${i}, this)">
        <option value="black"${r.color==='black'?' selected':''}>black</option>
        <option value="red"${r.color==='red'?' selected':''}>red</option>
        <option value="blue"${r.color==='blue'?' selected':''}>blue</option>
        <option value="yellow"${r.color==='yellow'?' selected':''}>yellow</option>
      </select>
    </div>
  </div>
  <div class="cell r ${c}"><div class="val" id="p${i}">${r.points}</div>
    <div class="btns"><div class="btn" onclick="tap(${i},'points',-1)">−</div><div class="btn" onclick="tap(${i},'points',1)">+</div><div class="btn" onclick="tap(${i},'points',5)">+5</div></div></div>
  <div class="cell r ${c}"><div class="val" id="g${i}">${r.guests}</div>
    <div class="btns"><div class="btn" onclick="tap(${i},'guests',-1)">−</div><div class="btn" onclick="tap(${i},'guests',1)">+</div><div class="btn" onclick="tap(${i},'guests',5)">+5</div></div></div>
  <div class="cell r ${c}"><div class="val" id="r${i}">${r.regulars}</div>
    <div class="btns"><div class="btn" onclick="tap(${i},'regulars',-1)">−</div><div class="btn" onclick="tap(${i},'regulars',1)">+</div></div></div>
  <div class="sep r"></div>`;
}
function render(){
  state=state.map(enforceRow);
  grid.querySelectorAll('.r').forEach(n=>n.remove());
  grid.insertAdjacentHTML('beforeend', state.map((r,i)=>rowTemplate(i,r)).join(''));
}
function escapeHtml(s){return String(s).replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));}

function onName(i,v){state[i].name=v;save();}
function onColor(i,sel){ const val=sel.value; state[i].color=val; sel.dataset.color=val; save(); render(); }

function tap(i,f,d){
  const r={...state[i]};
  if(f==='points'){r.points=(+r.points||0)+d;}
  else if(f==='guests'){r.guests=Math.min(30,Math.max(+r.regulars||0,(+r.guests||0)+d));}
  else if(f==='regulars'){r.regulars=(+r.regulars||0)+(d>0?1:-1); if((+r.guests||0)<r.regulars)r.guests=r.regulars;}
  state[i]=enforceRow(r); save(); haptic();
  document.getElementById(`p${i}`).textContent=state[i].points;
  document.getElementById(`g${i}`).textContent=state[i].guests;
  document.getElementById(`r${i}`).textContent=state[i].regulars;
}

const modal = document.getElementById('resetModal');
document.getElementById('reset').onclick = () => { modal.classList.add('show'); };
document.getElementById('reset-cancel').onclick = () => { modal.classList.remove('show'); };
document.getElementById('reset-ok').onclick = () => {
  state=[...Array(4)].map(()=>({name:'',points:0,guests:0,regulars:0,color:'black'}));
  save(); render(); modal.classList.remove('show');
};

document.getElementById('opening').onclick=()=>{
  state=state.map(r=>{
    const g=Math.max(0,Math.min(30,+r.guests||0));
    const inc=LUT[g]||0;
    return enforceRow({...r,points:(+r.points||0)+inc,guests:+r.regulars||0});
  });
  save(); render();
};

const fsBtn=document.getElementById('fs');
fsBtn.addEventListener('click', async ()=>{
  try{
    if(!document.fullscreenElement){ await document.documentElement.requestFullscreen(); }
    else{ await document.exitFullscreen(); }
  }catch(e){}
});
document.addEventListener('fullscreenchange', ()=>{ fsBtn.textContent=document.fullscreenElement?'×':'⤢'; });

render();
</script>
</body>
</html>
